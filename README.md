# フィールドワーク支援アプリ 総合ドキュメント

## 概要

このアプリケーションは、建設業やフィールドワークに従事する作業者を総合的に支援するために設計された多機能モバイルアプリケーションです。UIはスマートフォン型のフレームで囲まれており、モバイルでの利用を前提としたデザインになっています。

主要な機能は「スケジュール」「カメラ」「チャット」の3つのタブで構成されており、ユーザーは画面下部のナビゲーションバーでこれらの機能を切り替えることができます。

## アプリケーション構造

このアプリケーションは、`page.tsx`を起点として動作します。このコンポーネントが全体のレイアウトと状態管理を担っており、ユーザーの操作に応じて表示する画面を動的に切り替えています。

-   **状態管理**: `activeTab`（表示中のタブ）、`selectedTask`（選択中のタスク）、`currentDate`（スケジュールの日付）という3つの中心的なStateによってUIが制御されます。
-   **画面遷移**:
    -   `selectedTask`が`null`の場合、`activeTab`に応じたメイン画面（スケジュール、カメラ、チャットのいずれか）が表示されます。
    -   スケジュール画面でタスクを選択すると、その情報が`selectedTask`にセットされ、画面がタスク詳細（`TaskDetailScreen`）または経費申請（`ExpenseScreen`）に切り替わります。
    -   詳細画面から「戻る」を選択すると`selectedTask`が`null`に戻り、元のスケジュール画面が表示されます。
-   **日付ナビゲーション**: スケジュール画面では、左右の矢印ボタンで表示する日付を前後に移動できます。

## 主要機能

### 1. スケジュール・タスク管理

-   **タイムライン形式のスケジュール表示**: `DailySchedule`コンポーネントでその日のタスクを時系列に表示します。
-   **タスク詳細**: `TaskCard`をクリックすると`TaskDetailScreen`に遷移し、タスクの場所、時間、内容などの詳細情報を確認できます。
-   **入退場管理**: タスク詳細画面から手動での入場・退場打刻が可能です。また、GPSを利用した自動入退場機能も設定できます。
    -   現場からの距離を**ハーバーサイン公式**を用いて計算し、設定した範囲に出入りすると自動で入退場を記録します。

### 2. 作業報告

-   **新規作業報告**: `ReportModal`を使用して、タスクに対する作業報告を作成できます。報告内容には、「完了」「進行中」などの**作業状況**、具体的な**作業内容**、**問題・課題**、**次回対応事項**を記述できます。
-   **作業報告ログ**: `ReportLogModal`で、特定のタスクに関連する過去の作業報告を時系列で閲覧できます。

### 3. 高機能カメラ

-   **基本機能**: 前後カメラ切り替え、フラッシュ、9分割グリッド表示が可能です。
-   **CALS規格対応**: `CALSSettingsModal`で設定を有効にすると、工事写真の規格に準拠したファイル名で自動保存されます。
-   **電子小黒板**: 工事情報を写真にオーバーレイして撮影できます。`ElectronicBoardTemplateManager`でテンプレートの管理も可能です。

### 4. コミュニケーション

-   **リアルタイムチャット**: `ChatView`コンポーネントで個人・グループチャットに対応しています。
-   **通話と自動議事録**: 音声・ビデオ通話が可能で、通話内容は自動で文字起こしされ、議事録としてチャットに投稿されます。

### 5. 経費申請

-   **レシートOCR機能**: `ExpenseOCRCamera`でレシートを撮影すると、カテゴリ、金額、説明を自動で読み取ります。
-   **申請画面**: `ExpenseScreen`または`ExpenseModal`で経費項目を一覧で管理し、合計金額を確認して申請を完了できます。

## デザインシステム

アプリケーションの統一されたデザインは`tailwind.config.ts`ファイルで定義されています。特にカラーパレットは、ブランドカラーと業務上の意味合いを持つレギュレーションカラーで構成されています。

| カテゴリ             | 色名称               | カラーコード | 用途                                                              |
| :------------------- | :------------------- | :----------- | :---------------------------------------------------------------- |
| **ブランドカラー** | `primary.blue`       | `#2C5DFF`    | プライマリアクション、選択中のタブなど                   |
|                      | `background.blue`    | `#F1F4FF`    | 背景色、アクセント背景                                 |
| **レギュレーションカラー** | `regulation.black`   | `#001350`    | 主要なテキスト、ヘッダー                               |
|                      | `regulation.green`   | `#1DCE85`    | 完了、成功、有効、入場など（例：出勤ボタン、CALS有効表示） |
|                      | `regulation.yellow`  | `#FFCE2C`    | 注意、警告（例：経費申請ボタン）                       |
|                      | `regulation.red`     | `#FF2C5D`    | 危険、エラー、無効、退場など（例：退勤ボタン）         |


## コンポーネント構成

| ファイル名                               | 概要                                                                                                         |
| :--------------------------------------- | :----------------------------------------------------------------------------------------------------------- |
| **`page.tsx`** | **アプリケーションの起点となるメインコンポーネント。** 全体の状態を管理し、画面を切り替えるルーターの役割を担う。      |
| **`tailwind.config.ts`** | **Tailwind CSSのコンフィグファイル。** アプリケーション全体のデザインシステム（色、フォント等）を定義する。        |
| **`navigation-bar.tsx`** | 画面下部のナビゲーションバー。「カメラ」「スケジュール」「チャット」の主要機能へ切り替える。        |
| **`phone-frame.tsx`** | アプリケーションUI全体を囲む、装飾用のスマートフォン型フレーム。                                   |
| `daily-schedule.tsx`                     | 一日のタスクをタイムライン形式で表示する画面。                                                    |
| `task-detail-screen.tsx`                 | 選択されたタスクの詳細情報を表示する画面。手動・自動の入退場管理、作業報告機能へのハブ。               |
| `task-card.tsx`                          | 日次スケジュール画面で個々のタスクを表示するためのカード型コンポーネント。                               |
| `task-details-dialog.tsx`                | タスク詳細を簡易的に表示するためのダイアログ（モーダル）。                                           |
| `report-modal.tsx`                       | 新規に作業報告を作成するためのモーダル。                                                         |
| `report-log-modal.tsx`                   | 過去の作業報告を一覧で表示するモーダル。                                                         |
| `auto-attendance-modal.tsx`              | GPSによる自動入退場機能の設定モーダル。                                                            |
| `camera-view.tsx`                        | カメラ機能の中心となるビュー。ビデオ表示、撮影、各種設定モーダルの呼び出しを管理する。                    |
| `camera-menu-modal.tsx`                  | CALS規格と電子小黒板機能のON/OFFを切り替えるカメラ設定メニュー。                                  |
| `cals-settings-modal.tsx`                | CALS規格撮影に必要な情報（工事コード等）を設定するモーダル。                                      |
| `electronic-board-overlay.tsx`           | カメラビュー上に重ねて表示される、ドラッグ移動可能な電子小黒板。                                    |
| `electronic-board-settings-modal.tsx`    | 電子小黒板に表示する詳細情報を編集・設定するモーダル。                                           |
| `electronic-board-template-manager.tsx`  | 電子小黒板のテンプレートを管理（作成・編集・選択）するモーダル。                                 |
| `chat-view.tsx`                          | チャット機能全体のUI。チャットルーム一覧、メッセージ履歴、通話機能、自動議事録機能を管理する。           |
| `expense-screen.tsx`                     | 経費申請機能のメイン画面。経費項目の追加（手動/OCR）、一覧管理、申請処理を行う。                 |
| `expense-modal.tsx`                      | 経費申請をモーダル形式で行うためのコンポーネント。                                                  |
| `expense-ocr-camera.tsx`                 | レシート読み取り専用のカメラUI。撮影からOCR処理のシミュレーション、結果確認までを行う。           |
